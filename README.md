# Требования:

- Node v20.18.0
- yarn v1.22.22

# Конфиги для проекта

- **BACKEND_HOST / BACKEND_PORT:** универсальные переменные для подключения к backend 
  - Локально: `BACKEND_HOST` не установлена → Vite проксирует на `localhost`.
  - В develop docker: Vite проксирует на `BACKEND_HOST=backend` внутри Docker сети 
  - В production docker: Nginx проксирует на `BACKEND_HOST=backend` внутри Docker сети (backend не светит порты наружу)


### Локально
Локальные переменные создаются в файле .env в корне проекта. Они подхватываются с помощью `dotenv-cli`, а turborepo пробрасывает их дальше в приложения (задается в `globalEnv`). По умолчанию `BACKEND_HOST` задавать не нужно для локальной работы.

### Докер

Проект использует монорепу с Turbo и единый Dockerfile для всех приложений:
- `Dockerfile.dev` — для разработки (hot reload)
- `Dockerfile.prod` — для production (multi-target: backend-runner, frontend-runner)

В продовой версии фронт использует nginx для раздачи статики, его конфиг лежит в корне проекта.

**Переменные окружения:**
- Основные переменные находятся в `.env` файле в корне проекта
- Docker Compose автоматически читает `.env` и подставляет переменные через `${VARIABLE}`


Все порты (кроме nginx) настраиваются через `.env` файл.

**Важно:** Для сборки используется Docker BuildKit с cache mount для ускорения установки зависимостей.

# Запуск проекта

0. Клонировать репозиторий и установить зависимости. Для установки всех зависимостей проекта можно просто прописать команду в корней проекта

```bash
yarn install
```

1. Настроить переменные окружения. Если нужны другие порты, измени значения в `.env`:

```bash
# .env.example имеет нужные переменные с значения
```

## Локально в режиме разработки

```bash
yarn dev
```

## Локально в прод режиме

```bash
yarn preview
```

## В докер контейнере

- Режим разработки

```bash
make dev
```

- Режим прода

```bash
make prod
```

- Сборка без запуска (dev)

```bash
make build-dev
```

- Сборка без запуска (prod)

```bash
make build-prod
```

- Остановить проект

```bash
make stop
```

- Очистить контейнеры и volumes

```bash
make clean
```

### Как работает Docker сборка

Используется единый `Dockerfile` с параметризацией через `ARG APP`:
- **Dev:** `turbo prune` → установка deps → сборка зависимостей (`--filter=${APP}^...`) → hot reload в контейнере
- **Prod:** `turbo prune` → установка deps → полная сборка (`--filter=${APP}`) → multi-stage с отдельными финальными образами (Node.js для backend, Nginx для frontend)

BuildKit кеширует yarn зависимости между сборками
