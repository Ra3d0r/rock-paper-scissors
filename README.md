# Требования:

- Node v20.18.0
- yarn v1.22.22

# Конфиги для проекта

```
WS_PORT=5005
VITE_PORT=5173 # Порт для VITE сервера в дев и прод режиме
```

### Локально
Локальные переменные задаются в корневом package.json и являются глобальными между проектами. Для отдельных переменных можно создавать .env.local файл в каждом проекте

### Докер

Проект использует монорепу с Turbo и единый Dockerfile для всех приложений:
- `Dockerfile.dev` — для разработки (hot reload)
- `Dockerfile.prod` — для production (multi-target: backend-runner, frontend-runner)

В продовой версии фронт использует nginx для раздачи статики, его конфиг находится в папке frontend.

**Переменные окружения:**
- Основные переменные находятся в `.env` файле в корне проекта
- Docker Compose автоматически читает `.env` и подставляет переменные через `${VARIABLE}`
- **Важно для Vite:** переменные пробрасываются через `vite.config.ts` (define) и передаются на этапе сборки как build args

Все порты настраиваются через `.env` файл.

**Важно:** Для сборки используется Docker BuildKit с cache mount для ускорения установки зависимостей.

# Запуск проекта

0. Клонировать репозиторий и установить зависимости. Для установки всех зависимостей проекта можно просто прописать команду в корней проекта

```bash
yarn install
```

1. Настроить переменные окружения. Если нужны другие порты, измени значения в `.env`:

```bash
# .env.example имеет нужные переменные с значения
```

## Локально в режиме разработки

```bash
yarn dev
```

## Локально в прод режиме

```bash
yarn preview
```

## В докер контейнере

- Режим разработки

```bash
make dev
```

- Режим прода

```bash
make prod
```

- Сборка без запуска (dev)

```bash
make build-dev
```

- Сборка без запуска (prod)

```bash
make build-prod
```

- Остановить проект

```bash
make stop
```

- Очистить контейнеры и volumes

```bash
make clean
```

### Как работает Docker сборка

Используется единый `Dockerfile` с параметризацией через `ARG APP`:
- **Dev:** `turbo prune` → установка deps → сборка зависимостей (`--filter=${APP}^...`) → hot reload в контейнере
- **Prod:** `turbo prune` → установка deps → полная сборка (`--filter=${APP}`) → multi-stage с отдельными финальными образами (Node.js для backend, Nginx для frontend)

BuildKit кеширует yarn зависимости между сборками
