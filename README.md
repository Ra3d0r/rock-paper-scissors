# Требования:

- Node v20.18.0
- yarn v1.22.22

# Конфиги для проекта

```
WS_PORT=5005
VITE_PORT=5173 # Порт для VITE сервера в дев и прод режиме
```

### Локально
Локальные переменные задаются в корневом package.json и являются глобальными между проектами. Для отдельных переменных можно создавать .env.local файл в каждом проекте

### Докер

Проект использует монорепу с Turbo и единый Dockerfile для всех приложений:
- `Dockerfile.dev` — для разработки (hot reload)
- `Dockerfile.prod` — для production (multi-target: backend-runner, frontend-runner)

В продовой версии фронт использует nginx для раздачи статики, его конфиг находится в папке frontend.

Переменные для фронта и бека нужно создать в корне проекта с названиями `.env.back` и `.env.front`

Все порты находятся в docker-compose файлах. Порты должны совпадать с теми, что указываются в env файлах приложений.

**Важно:** Для сборки используется Docker BuildKit с cache mount для ускорения установки зависимостей.

# Запуск проекта

0. Клонировать репозиторий и установить зависимости. Для установки всех зависимостей проекта можно просто прописать команду в корней проекта

```bash
yarn install
```

## Локально в режиме разработки

```bash
yarn dev
```

## Локально в прод режиме

```bash
yarn preview
```

## В докер контейнере

- Режим разработки

```bash
make dev
```

- Режим прода

```bash
make prod
```

- Сборка без запуска (dev)

```bash
make build-dev
```

- Сборка без запуска (prod)

```bash
make build-prod
```

- Остановить проект

```bash
make stop
```

- Очистить контейнеры и volumes

```bash
make clean
```

### Как работает Docker сборка

Используется единый `Dockerfile` с параметризацией через `ARG APP`:
- **Dev:** `turbo prune` → установка deps → сборка зависимостей (`--filter=${APP}^...`) → hot reload в контейнере
- **Prod:** `turbo prune` → установка deps → полная сборка (`--filter=${APP}`) → multi-stage с отдельными финальными образами (Node.js для backend, Nginx для frontend)

BuildKit кеширует yarn dependencies между сборками — повторные builds ~10x быстрее.
